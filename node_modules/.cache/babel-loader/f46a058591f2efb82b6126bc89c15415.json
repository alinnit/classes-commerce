{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Alin\\\\Desktop\\\\Projects\\\\class-commerce\\\\src\\\\components\\\\Context.js\";\nimport React, { Component } from \"react\";\nimport _ from \"lodash\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const DataContext = /*#__PURE__*/React.createContext();\nexport class DataProvider extends Component {\n  constructor(props) {\n    super(props);\n\n    this.updateCurrency = currentCurrency => {\n      this.setState({\n        currentCurrency\n      });\n    };\n\n    this.getCartKey = _ref => {\n      let {\n        product,\n        selectedAttributes\n      } = _ref;\n      const {\n        name\n      } = product;\n\n      const attributesKey = _.sortBy(Object.entries(selectedAttributes), _ref2 => {\n        let [name] = _ref2;\n        return name;\n      }).map(_ref3 => {\n        let [name, item] = _ref3;\n        return `${name}-${item.id}`;\n      }).join(\"-\").concat(name);\n\n      return attributesKey;\n    };\n\n    this.addCart = (product, selectedAttributes) => {\n      const {\n        cart,\n        qty\n      } = this.state;\n      const cartKey = this.getCartKey({\n        product,\n        selectedAttributes\n      });\n      const cartItem = cart[cartKey] || {\n        product,\n        selectedAttributes\n      };\n      this.setState({\n        qty: ((cartItem === null || cartItem === void 0 ? void 0 : cartItem.qty) || 0) + 1\n      });\n      this.setState({\n        cart: { ...cart,\n          [cartKey]: { ...cartItem,\n            qty,\n            subTotal: (product === null || product === void 0 ? void 0 : product.prices[this.state.currentCurrency].amount) + (cartItem === null || cartItem === void 0 ? void 0 : cartItem.qty) * product.prices[this.state.currentCurrency].amount\n          }\n        }\n      });\n    };\n\n    this.deleteCart = (product, selectedAttributes) => {\n      const {\n        cart\n      } = this.state;\n      const cartKey = this.getCartKey({\n        product,\n        selectedAttributes\n      });\n      const cartItem = cart[cartKey] || {\n        product,\n        selectedAttributes\n      };\n      const qty = ((cartItem === null || cartItem === void 0 ? void 0 : cartItem.qty) || 1) - 1;\n\n      if (qty) {\n        this.setState({\n          cart: { ...cart,\n            [cartKey]: { ...cartItem,\n              qty,\n              subTotal: (cartItem === null || cartItem === void 0 ? void 0 : cartItem.qty) * product.prices[this.state.currentCurrency].amount - (product === null || product === void 0 ? void 0 : product.prices[this.state.currentCurrency].amount)\n            }\n          }\n        });\n      } else {\n        this.setState({\n          cart: _.pickBy({ ...cart,\n            [cartKey]: false\n          }, Boolean)\n        });\n      }\n    };\n\n    this.state = {\n      categories: [],\n      currentCurrency: \"0\",\n      cart: {},\n      product: {},\n      total: 0,\n      qty: 0\n    };\n  }\n\n  componentDidMount() {\n    this.loadCategories();\n  }\n\n  async loadCategories() {\n    var _categories$;\n\n    const res = await fetch(\"http://localhost:4000/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        query: `\n          query {\n            categories {\n              name\n              products {\n                id\n                name\n                inStock\n                gallery\n                description\n                category\n                attributes {\n                  id\n                  name\n                  type\n                  items {\n                    displayValue\n                    value\n                    id\n                  }\n                }\n                prices {\n                  currency {\n                    label\n                    symbol\n                  }\n                  amount\n                }\n                brand\n              }\n            }\n        }\n         `\n      })\n    });\n    const {\n      data\n    } = await res.json();\n    const {\n      categories\n    } = data || {};\n    this.setState({\n      categories,\n      products: categories === null || categories === void 0 ? void 0 : (_categories$ = categories[0]) === null || _categories$ === void 0 ? void 0 : _categories$.products\n    });\n  }\n\n  render() {\n    const {\n      products,\n      categories,\n      currentCurrency,\n      cart\n    } = this.state;\n    const {\n      children\n    } = this.props;\n    const {\n      updateCurrency,\n      addCart,\n      deleteCart\n    } = this;\n    const total = Object.values(this.state.cart).reduce((acc, item) => {\n      return acc + item.subTotal;\n    }, 0);\n    return /*#__PURE__*/_jsxDEV(DataContext.Provider, {\n      value: {\n        products,\n        categories,\n        currentCurrency,\n        updateCurrency,\n        cart,\n        addCart,\n        deleteCart,\n        total\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Alin/Desktop/Projects/class-commerce/src/components/Context.js"],"names":["React","Component","_","DataContext","createContext","DataProvider","constructor","props","updateCurrency","currentCurrency","setState","getCartKey","product","selectedAttributes","name","attributesKey","sortBy","Object","entries","map","item","id","join","concat","addCart","cart","qty","state","cartKey","cartItem","subTotal","prices","amount","deleteCart","pickBy","Boolean","categories","total","componentDidMount","loadCategories","res","fetch","method","headers","body","JSON","stringify","query","data","json","products","render","children","values","reduce","acc"],"mappings":"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","sourcesContent":["\nimport React, { Component } from \"react\"\nimport _ from \"lodash\"\n\n\nexport const DataContext = React.createContext()\n\nexport class DataProvider extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      categories: [],\n      currentCurrency: \"0\",\n      cart: {},\n      product: {},\n      total: 0,\n      qty: 0\n    }\n  }\n\n  updateCurrency = (currentCurrency) => {\n    this.setState({ currentCurrency })\n  }\n\n  getCartKey = ({ product, selectedAttributes }) => {\n    const { name } = product\n    const attributesKey = _.sortBy(Object.entries(selectedAttributes), ([name]) => name)\n      .map(([name, item]) => `${name}-${item.id}`)\n      .join(\"-\")\n      .concat(name)\n    return attributesKey\n\n  }\n\n  addCart = (product, selectedAttributes) => {\n    const { cart, qty } = this.state\n    const cartKey = this.getCartKey({ product, selectedAttributes })\n    const cartItem = cart[cartKey] || { product, selectedAttributes }\n    this.setState({ qty: (cartItem?.qty || 0) + 1 })\n    this.setState({ cart: {\n        ...cart,\n        [cartKey]: {\n          ...cartItem,\n          qty,\n          subTotal:\n            product?.prices[this.state.currentCurrency].amount +\n            (cartItem?.qty * product.prices[this.state.currentCurrency].amount)\n        }\n      } })\n  }\n\n  deleteCart = (product, selectedAttributes) => {\n    const { cart } = this.state\n    const cartKey = this.getCartKey({ product, selectedAttributes })\n    const cartItem = cart[cartKey] || { product, selectedAttributes }\n    const qty = (cartItem?.qty || 1) - 1\n    if (qty) {\n      this.setState({ cart: {\n        ...cart,\n        [cartKey]: {\n          ...cartItem,\n          qty,\n          subTotal:\n            (cartItem?.qty * product.prices[this.state.currentCurrency].amount) -\n            product?.prices[this.state.currentCurrency].amount\n        }\n      } })\n    } else {\n\n      this.setState({ cart: _.pickBy({\n        ...cart,\n        [cartKey]: false\n      }, Boolean)\n    })\n    }\n  }\n\n  componentDidMount() {\n    this.loadCategories()\n  }\n\n\n  async loadCategories() {\n    const res = await fetch(\"http://localhost:4000/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        query: `\n          query {\n            categories {\n              name\n              products {\n                id\n                name\n                inStock\n                gallery\n                description\n                category\n                attributes {\n                  id\n                  name\n                  type\n                  items {\n                    displayValue\n                    value\n                    id\n                  }\n                }\n                prices {\n                  currency {\n                    label\n                    symbol\n                  }\n                  amount\n                }\n                brand\n              }\n            }\n        }\n         `\n      })\n    })\n    const { data } = await res.json()\n    const { categories } = data || {}\n\n    this.setState({\n      categories,\n      products: categories?.[0]?.products,\n    })\n }\n\n  render() {\n    const { products, categories, currentCurrency, cart } = this.state\n    const { children } = this.props\n    const { updateCurrency, addCart, deleteCart } = this\n    const total = Object.values(this.state.cart).reduce((acc, item) => {\n      return acc + item.subTotal\n    }, 0)\n\n    return (\n      <DataContext.Provider\n        value={{\n          products,\n          categories,\n          currentCurrency,\n          updateCurrency,\n          cart,\n          addCart,\n          deleteCart,\n          total\n        }}\n      >\n        {children}\n\n      </DataContext.Provider>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}